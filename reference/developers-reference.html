<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developers Reference | Query/Response</title>
    <meta name="description" content="A VitePress Site">
    <meta name="generator" content="VitePress v1.2.3">
    <link rel="preload stylesheet" href="/query-response-spring-amqp/assets/style.CF5YbA3u.css" as="style">
    
    <script type="module" src="/query-response-spring-amqp/assets/app.BrXsOnQG.js"></script>
    <link rel="preload" href="/query-response-spring-amqp/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/query-response-spring-amqp/assets/chunks/framework.BLMDJhiA.js">
    <link rel="modulepreload" href="/query-response-spring-amqp/assets/chunks/theme.DHmPbZv7.js">
    <link rel="modulepreload" href="/query-response-spring-amqp/assets/chunks/attributes.BUGtF-W3.js">
    <link rel="modulepreload" href="/query-response-spring-amqp/assets/reference_developers-reference.md.APR1fw3k.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/query-response-spring-amqp/" data-v-ab179fa1><!--[--><!--]--><!----><span data-v-ab179fa1>Query/Response</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/query-response-spring-amqp/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/query-response-spring-amqp/guide/what-is-query-response.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/query-response-spring-amqp/reference/developers-reference.html" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Reference</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/olle/query-response-spring-amqp" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/olle/query-response-spring-amqp" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Guide</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/query-response-spring-amqp/guide/what-is-query-response.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>What is Query/Response</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/query-response-spring-amqp/guide/getting-started.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Getting started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/query-response-spring-amqp/guide/the-example-revisited.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Example revisited</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 has-active" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Reference</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/query-response-spring-amqp/reference/developers-reference.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Developers Reference</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/query-response-spring-amqp/reference/the-query-response-protocol.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Query/Response Protocol</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/query-response-spring-amqp/reference/query-response-maturity-model.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Maturity Model</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _query-response-spring-amqp_reference_developers-reference" data-v-39a288b8><div><h1 id="developers-reference" tabindex="-1">Developers Reference <a class="header-anchor" href="#developers-reference" aria-label="Permalink to &quot;Developers Reference&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The goal of Query/Response for Spring® AMQP is to provide developers with tools that are easy to use and understand. We believe that a procedural and imperative style of writing programs, or thinking about tasks in programs, is broadly understood and a very valuable model. With Query/Response for Spring® AMQP we try to support this, rather than introducing any new concepts for <em>streams</em>, <em>futures</em> or <em>promises</em>.</p><p>With Query/Response for Spring® AMQP developers should feel enabled to write code in a <em>normal</em> way. However, it is our mission to raise awareness of things that are hard to consider, when building <a href="https://en.wikipedia.org/wiki/Distributed_computing" target="_blank" rel="noreferrer">distributed systems</a>. The tools try to convey these considerations, by making them transparent and part of the API.</p><p>In the next couple of sections we&#39;ll look closer at the <code>QueryBuilder</code> and the <code>ResponseBuilder</code> types. We&#39;ll discuss how to use them in detail, and try to explain the concepts behind them, and the intention of their implementation.</p><h2 id="querybuilder" tabindex="-1"><code>QueryBuilder</code> <a class="header-anchor" href="#querybuilder" aria-label="Permalink to &quot;`QueryBuilder`&quot;">​</a></h2><p>The <code>QueryBuilder</code> class is a central point of entry, and provides a fluent builder-API, for publishing queries. It&#39;s provided as a bean, by enabling Query/Response for Spring® AMQP, using the <code>@EnableQueryResponse</code> annotation. It may be injected as a dependency to provide access from methods in any Spring component.</p><p>We recommend injecting it via the component constructor, and keeping it as a private field. The <code>findAuthors()</code> method below, shows how to access the <code>queryBuilder</code> field in order to publish a query.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Authors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QueryBuilder queryBuilder;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Authors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(QueryBuilder </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">queryBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.queryBuilder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryBuilder;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Collection&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findAuthors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;authors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">waitingFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>In the example above, the published query is defined by the string <strong>term</strong><code>&quot;authors&quot;</code>. This is how the most basic contract of Query/Response is defined. Any string or text term may be published as a query.</p><p>The second argument is the expected type of any received response elements. It is not published with the query, but rather used to coerce or interpret any received responses. This means that regardless of the payload of any response, in this case Query/Response for Spring® AMQP will attempt to read the response elements as the declared type <code>String.class</code>.</p><p>Queries are built and published using the <code>queryFor(..)</code> <em>initial</em> method. Any following call to one of the <em>terminal</em> methods <code>orEmpty()</code>, <code>orDefaults(..)</code> and <code>orThrows(..)</code> will build and execute the query, and block on the calling thread.</p><p>Since the call above to <code>orEmpty()</code> blocks the thread, users have to specify one or more query <em>conditionals</em>. In the example above, the call to <code>waitingFor(..)</code> defines that the call will block for around 800 milliseconds.</p><p>Constructing queries with the <code>QueryBuilder</code> revolves around creating a composition of <em>initial</em>, <em>conditional</em>, an optional <em>informal</em> and exactly one <em>terminal</em> method call. In the table below is a short review of the different builder methods and their types.</p><h3 id="querybuilder-fluid-api-method-types" tabindex="-1"><code>QueryBuilder</code> fluid API method types <a class="header-anchor" href="#querybuilder-fluid-api-method-types" aria-label="Permalink to &quot;`QueryBuilder` fluid API method types&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Method</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>queryFor(..)</code></td><td><em>initial</em></td><td>Creates a new builder for a query</td></tr><tr><td><code>waitingFor(..)</code></td><td><em>conditional</em></td><td>Specifies the waiting/blocking condition</td></tr><tr><td><code>takingAtMost(..)</code></td><td><em>conditional</em></td><td>Sets a limit condition, a maximum</td></tr><tr><td><code>takingAtLeast(..)</code></td><td><em>conditional</em></td><td>Sets a limit condition, a minimum</td></tr><tr><td><code>orEmpty()</code></td><td><em>terminal</em></td><td>Terminates with empty, after conditionals are evaluated</td></tr><tr><td><code>orDefaults(..)</code></td><td><em>terminal</em></td><td>Terminates with some defaults, after conditionals are evaluated</td></tr><tr><td><code>orThrow(..)</code></td><td><em>terminal</em></td><td>Terminates by throwing, after conditionals are evaluated</td></tr><tr><td><code>onError(..)</code></td><td><em>informal</em></td><td>Allows for explicit logging etc.</td></tr></tbody></table><p>Let&#39;s take a closer look at each of the builder method types.</p><h3 id="initial-methods" tabindex="-1"><em>Initial</em> methods <a class="header-anchor" href="#initial-methods" aria-label="Permalink to &quot;_Initial_ methods&quot;">​</a></h3><p>At the moment there&#39;s only one <em>initial</em> method and it&#39;s declared as:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChainingQueryBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String term, Class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type)</span></span></code></pre></div><p>So we can query for any <code>String</code> <strong>term</strong> and given the expected mapped or coerced <strong>type</strong> as a <code>Class&lt;T&gt;</code>. The returned <code>ChainingQueryBuilder&lt;T&gt;</code> provides the capabilities of the fluid API.</p><h3 id="conditional-methods" tabindex="-1"><em>Conditional</em> methods <a class="header-anchor" href="#conditional-methods" aria-label="Permalink to &quot;_Conditional_ methods&quot;">​</a></h3><p>All <em>conditional</em> properties can be composed together by the <code>QueryResponse</code> builder API, to define whether a query is successful or not. If an executing query is completed in a <em>successful</em> way, fulfilling the <em>conditionals</em>, it will return and not consume any more responses.</p><ul><li><p><code>waitingFor(..)</code> - defines a timeout <em>conditional</em>. The built query will evaluate as <em>successful</em> if <em>any</em> responses were consumed after the (approximate) given time limit has elapsed. There are a few different methods declared, to specify the timeout:</p><ul><li><code>waitingFor(long millis)</code></li><li><code>waitingFor(long amount, TemporalUnit timeUnit)</code></li><li><code>waitingFor(Duration duration)</code></li></ul></li><li><p><code>takingAtMost(int atMost)</code> - defines a limiting <em>conditional</em> on the aggregated number of received elements. The built query evaluates to <em>successful</em>, and returns, when the given amount is reached.</p></li><li><p><code>takingAtLeast(int atLeast)</code> - defines a minimum <em>conditional</em> on the number of received element. The built query evaluates to <em>successful</em>, only if at least the given number of elements can be consumed.</p></li></ul><h3 id="terminal-methods" tabindex="-1"><em>Terminal</em> methods <a class="header-anchor" href="#terminal-methods" aria-label="Permalink to &quot;_Terminal_ methods&quot;">​</a></h3><p>Only one <em>terminal</em> method can be invoked on the builder, per query. It will ensure that the query is built and executed. All <em>terminal</em> methods are declared to return <code>Collection&lt;T&gt;</code> where the type parameter <code>&lt;T&gt;</code> is given in the <em>initial</em> method <code>type</code> parameter.</p><ul><li><p><code>orEmpty()</code> - defines the query to return an empty <code>Collection</code> in case the <em>conditionals</em> do not evaluate to <em>successful</em>.</p></li><li><p><code>orDefaults(..)</code> - defines the query to return with some provided <em>defaults</em> in case the <em>conditionals</em> do not evaluate to <em>successful</em>. There are a couple different methods declared for defaults:</p><ul><li><code>orDefaults(Collection&lt;T&gt; defaults)</code> - set at <em>call-time</em>.</li><li><code>orDefaults(Supplier&lt;Collection&lt;T&gt;&gt; defaults)</code> - supplied lazily at <em>run-time</em>.</li></ul></li><li><p><code>orThrow(..)</code> - defines the query to throw an exception in case the <em>conditionals</em> do not evaluate to <em>successful</em>.</p></li></ul><div class="warning custom-block"><p class="custom-block-title">Careful</p><p>Note the difference in <em>call-time</em> and <em>response-time</em> - since the call to the <em>terminal</em> method is a blocking call, any fetched results as defaults are prepared as the query is built. In order to dynamically provide better defaults at <em>run-time</em>, use the lazy supplier instead.</p></div><h3 id="informal-methods" tabindex="-1"><em>Informal</em> methods <a class="header-anchor" href="#informal-methods" aria-label="Permalink to &quot;_Informal_ methods&quot;">​</a></h3><p>Currently there&#39;s only one <em>informal</em> builder method, allowing for extended logging or information capture, in case the query fails or an exception is thrown.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChainingQueryBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Throwable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> handler)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Try to think more about how the <code>QueryBuilder</code> API covers the exceptional query-cases, as part of the composition of <em>conditionals</em>. If clients try to use <em>terminals</em> that provide sensible defaults, it may not be necessary to build other types of complex recovery or retries.</p></div><h3 id="querybuilder-examples" tabindex="-1"><code>QueryBuilder</code> examples <a class="header-anchor" href="#querybuilder-examples" aria-label="Permalink to &quot;`QueryBuilder` examples&quot;">​</a></h3><p>Below are some examples of how the different <code>QueryBuilder</code> API methods can be combined.</p><p>Using <code>takingAtMost(..)</code>, combined with <code>waitingFor(..)</code>, preserves system resources and the client can be protected from consuming too much data.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;authors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">takingAtMost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">waitingFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orDefaults</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Authors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defaults</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre></div><p>It is possible to express constraints at the integration point, also when using Query/Response for Spring® AMQP, throwing on an unfulfilled query, as an option to more lenient handling with defaults.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offers/rental&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Offer.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">takingAtLeast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">takingAtMost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">waitingFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ChronoUnit.SECONDS)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orThrow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TooFewOffersConstraintException</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>The <em>informal</em> builder feature, allows for transparency into queries that may have to be observed.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offers/rental&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NewOffer.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">takingAtLeast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">waitingFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LOG.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Failure!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orThrow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TooFewOffersConstraintException</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="responsebuilder" tabindex="-1"><code>ResponseBuilder</code> <a class="header-anchor" href="#responsebuilder" aria-label="Permalink to &quot;`ResponseBuilder`&quot;">​</a></h2><p>Another entry-point into Query/Response for Spring® AMQP is the <code>ResponseBuilder</code>. It provides a fluid builder-API that allows users to create responding services or components.</p><p>It is also provided as a bean, when using the <code>@EnableQueryResponse</code> annotation in a Spring application. It can easily be injected as a dependency to provide access from methods in Spring components.</p><p>The <code>respondWithAuthors()</code> method below, shows how the injected builder is used to create a responding service. It is invoked by the Spring application context, on the <code>ApplicationReadyEvent</code> event.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OnlyThreeAuthors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ResponseBuilder responseBuilder;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OnlyThreeAuthors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ResponseBuilder </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">responseBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.responseBuilder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> responseBuilder;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ApplicationReadyEvent.class)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> respondWithAuthors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        responseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">respondTo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;authors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tolkien&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lewis&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Rowling&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>In the example above the responding service is defined by calling the builder method <code>respondTo(..)</code> with the query <strong>term</strong> parameter <code>&quot;authors&quot;</code>. It will be bound to publish the given 3 authors as <code>String.class</code> entries, whenever it consumes a query for the matching string <strong>term</strong> <code>&quot;authors&quot;</code>.</p><p>This is the most basic premiss of Query/Response, that any string or text term may be interpreted as a query - it is however up to the response publisher to determine what the query means.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>We&#39;ve tried to provide information around the Query/Response <em>protocol</em> and philosophy in the later chapter on <a href="./the-query-response-protocol.html">The Query/Response Protocol</a>. Go there to find out more.</p></div><p>The second parameter is the the type of each element, that will be published in the response. It is given both as a type hint for the compiler, as well as a parameter to the data mapper. Here it&#39;s trivial, the three authors are given as <code>String.class</code> entries.</p><div class="info custom-block"><p class="custom-block-title">Note</p><p>The data mapper mentioned above, is in fact the <code>com.fasterxml.jackson.databind.ObjectMapper</code> and Query/Response for Spring® AMQP currently uses JSON as the transport format. This means that type hints, JSON mapping configuration annotations or custom mappings will apply. However as data mapping on the consumer side is done by coercion, the published format must conform to some agreed upon standard, shape or protocol.</p></div><p>Response publishers are built using the <code>respondTo(..)</code> <em>initial</em> method. Any following call to one of the <em>terminal</em> methods <code>from(..)</code> or <code>suppliedBy(..)</code> will create and register it, as its own consumer in another thread. The builder call returns immediately.</p><p>The <code>ResponseBuilder</code> comes with some methods to allow for <em>partitioning</em> or <em>batching</em>, which can be used to control the transfer of data to some degree.</p><p>The table below shows a summary of the builder methods and types.</p><h3 id="responsebuilder-fluid-api-method-types" tabindex="-1"><code>ResponseBuilder</code> fluid API method types <a class="header-anchor" href="#responsebuilder-fluid-api-method-types" aria-label="Permalink to &quot;`ResponseBuilder` fluid API method types&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Method</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>respondTo(..)</code></td><td><em>initial</em></td><td>Creates a new builder for a query</td></tr><tr><td><code>withAll()</code></td><td><em>batching</em></td><td>Specifies NO batches</td></tr><tr><td><code>withBatchesOf(..)</code></td><td><em>batching</em></td><td>Sets the batch size of responses</td></tr><tr><td><code>from(..)</code></td><td><em>terminal</em></td><td>Terminates with some given response data</td></tr><tr><td><code>suppliedBy(..)</code></td><td><em>terminal</em></td><td>Terminates with some supplied response data</td></tr></tbody></table><p>Let&#39;s take a closer look at each of the builder method types.</p><h3 id="initial-methods-1" tabindex="-1"><em>Initial</em> methods <a class="header-anchor" href="#initial-methods-1" aria-label="Permalink to &quot;_Initial_ methods&quot;">​</a></h3><p>At the moment there&#39;s only one <em>initial</em> method for building responses. It is declared as:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChainingResponseBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> respondTo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String term, Class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type)</span></span></code></pre></div><p>So we can create a response for any <code>String</code> <strong>term</strong> and declare that we intend to publish elements of some <strong>type</strong> given as a <code>Class&lt;T&gt;</code>. The returned <code>ChainingResponseBuilder&lt;T&gt;</code> provides the capabilities of the fluid API.</p><h3 id="batching-methods" tabindex="-1"><em>Batching</em> methods <a class="header-anchor" href="#batching-methods" aria-label="Permalink to &quot;_Batching_ methods&quot;">​</a></h3><p>Control over how response elements are published can be made by using the <em>batching</em> methods that the builder provides.</p><ul><li><p><code>withAll()</code> - defines that <strong>no</strong> batching should be used, and will publish all given elements, or try to drain a supplied <code>Iterator</code> all at once.</p></li><li><p><code>withBatchesOf(int size)</code> - defines a batch size, which the response publisher will use, to create a series of response messages, with up-to the given <code>size</code> of elements.</p></li></ul><h3 id="terminal-methods-1" tabindex="-1"><em>Terminal</em> methods <a class="header-anchor" href="#terminal-methods-1" aria-label="Permalink to &quot;_Terminal_ methods&quot;">​</a></h3><p>Only one <em>terminal</em> method can be called on the builder, per response. It will ensure that a responder is created and added as a query-consumer, a subscriber to the query <strong>term</strong> as a topic. It is not attached to the calling thread, so the builder call always returns after the <em>terminal</em> call.</p><ul><li><p><code>from(..)</code> - declares the source for the provided response data elements. It is declared in a few different ways, for alternative use:</p><ul><li><code>from(T... elements)</code> - vararg elements</li><li><code>from(Collection&lt;T&gt; elements)</code> - provided collection at <em>build-time</em></li><li><code>from(Supplier&lt;Iterator&lt;T&gt;&gt; elements)</code> - supplied iterator at <em>build-time</em></li></ul></li><li><p><code>suppliedBy(Supplier&lt;Collection&lt;T&gt;&gt; elements)</code> - declares that response data is supplied at <em>run-time</em>.</p></li></ul><h3 id="responsebuilder-examples" tabindex="-1"><code>ResponseBuilder</code> examples <a class="header-anchor" href="#responsebuilder-examples" aria-label="Permalink to &quot;`ResponseBuilder` examples&quot;">​</a></h3><p>Batch responses provide developers with more options to tune and throttle a system using Query/Response across many services. It may tune and change the profile of resource use, in a network.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">responseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">respondTo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;offers/monday&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Offer.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withBatchesOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(offers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findAllOffersByDayOfWeek</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Calendar.MONDAY));</span></span></code></pre></div><p>Dynamic responses are easy to build, with an API that suits modern Java, using lazy calls to suppliers of data.</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">responseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">respondTo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;users/current&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Token.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withBatchesOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">suppliedBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userTokenService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">findAllCurrentUserTokens);</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><div class="edit-info" data-v-d4a0bba5><!----><div class="last-updated" data-v-d4a0bba5><p class="VPLastUpdated" data-v-d4a0bba5 data-v-7e05ebdb>Last updated: <time datetime="2024-07-10T17:06:52.000Z" data-v-7e05ebdb></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link prev" href="/query-response-spring-amqp/guide/the-example-revisited.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Previous page</span><span class="title" data-v-d4a0bba5>Example revisited</span><!--]--></a></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/query-response-spring-amqp/reference/the-query-response-protocol.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>Query/Response Protocol</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Published under the Apache-2.0 license</p><p class="copyright" data-v-e315a0ad>Copyright © 2019-2024 Olle Törnström and all other contributors.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"reference_the-query-response-protocol.md\":\"B-gp6A0B\",\"reference_query-response-maturity-model.md\":\"B_1-RK-U\",\"guide_the-example-revisited.md\":\"CPfN9cTx\",\"guide_getting-started.md\":\"BNqf6LR1\",\"index.md\":\"B8Ay4yEG\",\"guide_what-is-query-response.md\":\"BgwoPFLM\",\"reference_developers-reference.md\":\"APR1fw3k\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Query/Response\",\"description\":\"A VitePress Site\",\"base\":\"/query-response-spring-amqp/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Guide\",\"link\":\"/guide/what-is-query-response\"},{\"text\":\"Reference\",\"link\":\"/reference/developers-reference\"}],\"sidebar\":[{\"text\":\"Guide\",\"items\":[{\"text\":\"What is Query/Response\",\"link\":\"/guide/what-is-query-response\"},{\"text\":\"Getting started\",\"link\":\"/guide/getting-started\"},{\"text\":\"Example revisited\",\"link\":\"/guide/the-example-revisited\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"Developers Reference\",\"link\":\"/reference/developers-reference\"},{\"text\":\"Query/Response Protocol\",\"link\":\"/reference/the-query-response-protocol\"},{\"text\":\"Maturity Model\",\"link\":\"/reference/query-response-maturity-model\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/olle/query-response-spring-amqp\"}],\"footer\":{\"message\":\"Published under the Apache-2.0 license\",\"copyright\":\"Copyright © 2019-2024 Olle Törnström and all other contributors.\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>